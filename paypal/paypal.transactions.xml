<?xml version="1.0" encoding="UTF-8"?>
<table xmlns="http://query.yahooapis.com/v1/schema/table.xsd" https="true">
  <meta>
    <sampleQuery> select * from {table} WHERE APIUsername="your_api_username" AND APIPassword="your_api_password" AND Signature="your_api_aignature AND StartDate="YYYY-MM-DDThh:MM:ss.mmmZ" AND Endpoint="sandbox"</sampleQuery>
    <sampleQuery> select * from {table} WHERE APIUsername="your_api_username" AND APIPassword="your_api_password" AND Signature="your_api_aignature AND StartDate="YYYY-MM-DDThh:MM:ss.mmmZ" AND Payer="your-payer-email-that-youwant-to-narrow-down-results" AND Endpoint="sandbox"</sampleQuery>
    <sampleQuery>SELECT * FROM paypal.transaction.details WHERE APIUsername="your_api_username" AND APIPassword="your_api_password" AND Signature="your_api_aignature" AND Endpoint="sandbox" AND TransactionID in (SELECT PaymentTransactions.TransactionID FROM {table} WHERE StartDate="YYYY-MM-DDThh:MM:ss.mmmZ" AND Payer="your-payer-email-that-youwant-to-narrow-down-results" AND APIUsername="your_api_username" AND APIPassword="your_api_password" AND Signature="your_api_aignature")</sampleQuery>
     
    <description>The PayPal Transaction Details API allows you to obtain details about a specific transaction. The details include information from Payer, shipping address to the amount charged. Please note that inorder to be able to use the API to obtain the details of a transaction, you must either be the owner of the business account that's marked as the receiver of the payment or have obtained API access from the corresponding receiver account owner. Please refer to the GetTransactionDetails API documentation on x.com to understand the data returned by the API.</description>
    <documentationURL>www.x.com/developers/paypal/products/transactional-information</documentationURL>

  </meta>
  <bindings>
    <select produces="JSON">
      <inputs>
        <key id='APIUsername' type='xs:string' paramType='variable' required="true" />
        <key id='APIPassword' type='xs:string' paramType='variable' required="true" />
        <key id='Signature' type='xs:string' paramType='variable' required="true" />
        <key id='TransactionID' type='xs:string' paramType='variable' required="false" />
        <key id='Endpoint' type='xs:string' paramType='variable' required="true" />
        <key id='StartDate' type='xs:string' paramType='variable'	required="true" />
	<key id='EndDate' type='xs:string' paramType='variable'	required="false" />
	<key id='Payer' type='xs:string' paramType='variable' required="false" />
	<key id='Receiver' type='xs:string' paramType='variable' required="false" />
	<key id='ReceiptID' type='xs:string' paramType='variable'		required="false" />
	<key id='TransactionID' type='xs:string' paramType='variable'	required="false" />
	<key id='InvoiceID' type='xs:string' paramType='variable' required="false" />
	<key id='CardNumber' type='xs:string' paramType='variable' required="false" />
	<key id='AuctionItemNumber' type='xs:string' paramType='variable' required="false" />
	<key id='Status' type='xs:string' paramType='variable' required="false" />
	<key id='PayerFirstName' type='xs:string' paramType='variable' required="false" />
	<key id='PayerLastName' type='xs:string' paramType='variable' required="false" />
	<key id='PayerMiddleName' type='xs:string' paramType='variable' required="false" />
	<key id='PayerSalutation' type='xs:string' paramType='variable' required="false" />
	<key id='PayerSuffix' type='xs:string' paramType='variable' required="false" />
	<key id='Amount' type='xs:string' paramType='variable' required="false" />
	<key id='CurrencyCode' type='xs:string' paramType='variable' required="false" />
	<key id='TransactionClass' type='xs:string' paramType='variable'	required="false" />

      </inputs>
      <execute><![CDATA[
        var txn_details_req = "METHOD=TransactionSearch&VERSION=88&PWD=" + inputs['APIPassword'] + "&USER=" + inputs['APIUsername'] + "&SIGNATURE=" + inputs['Signature'];
       
        
        if(inputs['TransactionID']) {
         txn_details_req += "&TRANSACTIONID=" + inputs['TransactionID'];
        }
        
        if(inputs['StartDate']) {
         txn_details_req += "&StartDate=" + inputs['StartDate'];
        }
        
        if(inputs['EndDate']) {
         txn_details_req += "&EndDate=" + inputs['EndDate'];
        }
        
        if(inputs['Payer']) {
         txn_details_req += "&Payer=" + inputs['Payer'];
        }
        
        if(inputs['Receiver']) {
         txn_details_req += "&Receiver=" + inputs['Receiver'];
        }
        
        if(inputs['ReceiptID']) {
         txn_details_req += "&ReceiptID=" + inputs['ReceiptID'];
        }
        
        if(inputs['InvoiceID']) {
         txn_details_req += "&InvoiceID=" + inputs['InvoiceID'];
        }
        
        if(inputs['CardNumber']) {
         txn_details_req += "&CardNumber=" + inputs['CardNumber'];
        }
        
        if(inputs['AuctionItemNumber']) {
         txn_details_req += "&AuctionItemNumber=" + inputs['AuctionItemNumber'];
        }
        
        if(inputs['Status']) {
         txn_details_req += "&Status=" + inputs['Status'];
        }
        
        txn_details_req += "&PayerFirstName=" + inputs['PayerFirstName'];
        if(inputs['PayerFirstName']) {
         txn_details_req += "&PayerFirstName=" + inputs['PayerFirstName'];
        }
        
        if(inputs['PayerLastName']) {
         txn_details_req += "&PayerLastName=" + inputs['PayerLastName'];
        }
        
        if(inputs['PayerMiddleName']) {
         txn_details_req += "&PayerMiddleName=" + inputs['PayerMiddleName'];
        }
        
        if(inputs['PayerSalutation']) {
         txn_details_req += "&PayerSalutation=" + inputs['PayerSalutation'];
        }
        
        if(inputs['PayerSuffix']) {
         txn_details_req += "&PayerSuffix=" + inputs['PayerSuffix'];
        }
        
        if(inputs['Amount']) {
         txn_details_req += "&Amount=" + inputs['Amount'];
        }
        
        if(inputs['CurrencyCode']) {
         txn_details_req += "&CurrencyCode=" + inputs['CurrencyCode'];
        }
        
        if(inputs['TransactionClass']) {
         txn_details_req += "&TransactionClass=" + inputs['TransactionClass'];
        }
        
        
        
        var responseObj = {};
        var temp;
        if(inputs['Endpoint'] == 'sandbox') {
            temp = y.rest("https://api-3t.sandbox.paypal.com/nvp?" + txn_details_req).get().response;
        } else {
            temp = y.rest("https://api-3t.paypal.com/nvp?" + txn_details_req).get().response;
        }
        
        responseObj = temp.split("&");
        
        response.object = {'details': responseObj};
        
]]></execute>
    </select>
  </bindings>
</table>